<pre class="shiki light-plus" style="background-color: #FFFFFF"><code><span class="line"><span style="color: #AF00DB">package </span><span style="color: #0000FF">MagicExplorer</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">magic.dsl.*  </span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">magic.prelude.*  </span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">magic.config.Config </span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">magic.model.ollama.OllamaEmbeddingModel</span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">magic.mcp.*</span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">magic.rag.graph.{MiniRagBuilder,MiniRagConfig,MiniRag}</span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">magic.tokenizer.Cl100kTokenizer</span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">magic.core.model.{ChatModel, EmbeddingModel}</span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">magic.model.openai.*</span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">magic.dsl.tool</span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">magic.tool.*</span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">magic.mcp.StdioMCPServer</span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">std.fs.*</span></span>
<span class="line"><span style="color: #AF00DB">import </span><span style="color: #0000FF">std.io.*</span></span>
<span class="line"><span style="color: #AF00DB">let</span><span style="color: #001080"> mcpServerPath</span><span style="color: #000000"> = </span><span style="color: #A31515">"browser-manipulator-refactored/mcpServer.js"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000">//"Log into youtube and then play rick roll video on youtube."</span></span>
<span class="line"><span style="color: #008000">//"Submit an application to a Software Engineering job in Phili at Susqehanna, use my CV which is in file cv.pdf."</span></span>
<span class="line"><span style="color: #008000">//Go to amazon and add all products from 'List of item to purchase' to basket. Then purchase them. If nessesary create an account."</span></span>
<span class="line"><span style="color: #008000">//"Fill out a reservation for me for a one-way flight from Edinburgh to Krakow on ryanair website, with depart date on August 8th 2025. I will only take cabin bag, dont want to select seats or anything additional."</span></span>
<span class="line"><span style="color: #008000">//"send an email to maksymilian.sieklinski@gmail.com saying that you will send him his money in two weeks time. Make the email text a poem."</span></span>
<span class="line"><span style="color: #008000">//"Go from huawei wikipedia page to ramen wikipedia page."</span></span>
<span class="line"><span style="color: #008000">//"Log into strava account and find out how many followers you have"</span></span>
<span class="line"><span style="color: #008000">//"Go to this website, and see if you can solve the challenge: https://2captcha.com/demo/normal"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">func</span><span style="color: #795E26"> instantiateModel</span><span style="color: #000000">() {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">var</span><span style="color: #001080"> agent</span><span style="color: #000000"> = </span><span style="color: #795E26">Executor</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">let</span><span style="color: #001080"> agentTools</span><span style="color: #000000"> = </span><span style="color: #001080">agent</span><span style="color: #000000">.</span><span style="color: #001080">client</span><span style="color: #000000">.</span><span style="color: #001080">tools</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">loadAgentSpecifications</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">println</span><span style="color: #000000">(</span><span style="color: #001080">API_MODEL</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">let</span><span style="color: #001080"> cangjieWrapperTools</span><span style="color: #000000"> : </span><span style="color: #267F99">Array</span><span style="color: #000000">&#x3C;</span><span style="color: #267F99">String</span><span style="color: #000000">> = [</span><span style="color: #A31515">"screenshot"</span><span style="color: #000000">,</span><span style="color: #A31515">"click"</span><span style="color: #000000">,</span><span style="color: #A31515">"currentUrl"</span><span style="color: #000000">,</span><span style="color: #A31515">"back"</span><span style="color: #000000">,</span><span style="color: #A31515">"uploadFile"</span><span style="color: #000000">,</span><span style="color: #A31515">"urlNavigator"</span><span style="color: #000000">,</span><span style="color: #A31515">"passCaptcha"</span><span style="color: #000000">,</span><span style="color: #A31515">"close"</span><span style="color: #000000">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">for</span><span style="color: #000000">(</span><span style="color: #001080">tool</span><span style="color: #000000"> </span><span style="color: #AF00DB">in</span><span style="color: #000000"> </span><span style="color: #001080">agentTools</span><span style="color: #000000">){</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000">(!</span><span style="color: #001080">cangjieWrapperTools</span><span style="color: #000000">.</span><span style="color: #795E26">contains</span><span style="color: #000000">(</span><span style="color: #001080">tool</span><span style="color: #000000">.</span><span style="color: #001080">name</span><span style="color: #000000">)){</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #001080">agent</span><span style="color: #000000">.</span><span style="color: #001080">toolManager</span><span style="color: #000000">.</span><span style="color: #795E26">addTools</span><span style="color: #000000">(</span><span style="color: #795E26">ArrayList</span><span style="color: #000000">&#x3C;</span><span style="color: #267F99">Tool</span><span style="color: #000000">>([</span><span style="color: #001080">tool</span><span style="color: #000000">]))</span></span>
<span class="line"><span style="color: #000000">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">agent</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">func</span><span style="color: #795E26"> executeGoal</span><span style="color: #000000">(</span><span style="color: #001080">currentGoal</span><span style="color: #000000">: </span><span style="color: #267F99">String</span><span style="color: #000000">): </span><span style="color: #267F99">String</span><span style="color: #000000">{</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">let</span><span style="color: #001080"> isSubGoal</span><span style="color: #000000"> : </span><span style="color: #AF00DB">Bool</span><span style="color: #000000"> = (</span><span style="color: #001080">currentGoal</span><span style="color: #000000"> != </span><span style="color: #001080">goal</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">let</span><span style="color: #001080"> prevGoal</span><span style="color: #000000"> = </span><span style="color: #001080">goal</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">goal</span><span style="color: #000000"> = </span><span style="color: #001080">currentGoal</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">executorPrompt</span><span style="color: #000000"> = </span><span style="color: #795E26">getPrompt</span><span style="color: #000000">(</span><span style="color: #A31515">'executor-prompt.md'</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">let</span><span style="color: #001080"> agent</span><span style="color: #000000"> = </span><span style="color: #795E26">instantiateModel</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">while</span><span style="color: #000000">(</span><span style="color: #AF00DB">let</span><span style="color: #001080"> Some</span><span style="color: #000000">(</span><span style="color: #001080">decision</span><span style="color: #000000">) &#x3C;- </span><span style="color: #001080">agent</span><span style="color: #000000">.</span><span style="color: #795E26">chatGet</span><span style="color: #000000">&#x3C;</span><span style="color: #267F99">ExecutorValue</span><span style="color: #000000">>(</span><span style="color: #A31515">"Complete an incremental step towards your goal</span><span style="color: #EE0000">\n</span><span style="color: #A31515"> List of previous actions: </span><span style="color: #000000">${</span><span style="color: #001080">agent</span><span style="color: #000000">.</span><span style="color: #001080">memoryManager</span><span style="color: #000000">}</span><span style="color: #A31515">."</span><span style="color: #000000">)){</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #795E26">println</span><span style="color: #000000">(</span><span style="color: #001080">agent</span><span style="color: #000000">.</span><span style="color: #001080">memoryManager</span><span style="color: #000000">.</span><span style="color: #795E26">back</span><span style="color: #000000">())</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000">(</span><span style="color: #001080">decision</span><span style="color: #000000">.</span><span style="color: #001080">finishedExecution</span><span style="color: #000000">){</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #795E26">println</span><span style="color: #000000">(</span><span style="color: #001080">decision</span><span style="color: #000000">.</span><span style="color: #001080">result</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #001080">goal</span><span style="color: #000000"> = </span><span style="color: #001080">prevGoal</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #008000">// Closes Page</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #AF00DB">if</span><span style="color: #000000">(</span><span style="color: #001080">isSubGoal</span><span style="color: #000000">){ </span><span style="color: #001080">agent</span><span style="color: #000000">.</span><span style="color: #795E26">callMCPTool</span><span style="color: #000000">(</span><span style="color: #A31515">"close"</span><span style="color: #000000">) }</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">decision</span><span style="color: #000000">.</span><span style="color: #001080">result</span></span>
<span class="line"><span style="color: #000000">        }</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">goal</span><span style="color: #000000"> = </span><span style="color: #001080">prevGoal</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #A31515">"Agent failure"</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AF00DB">main</span><span style="color: #000000">(): </span><span style="color: #AF00DB">Int64</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// Create the agent with the MCP server configured</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">executeGoal</span><span style="color: #000000">(</span><span style="color: #001080">goal</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #098658">0</span></span>
<span class="line"><span style="color: #000000">}</span></span></code></pre>